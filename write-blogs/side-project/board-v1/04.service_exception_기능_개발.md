>ì´ì „ê¸€ [ğŸ”— [Spring] RestControllerAdvice ë¥¼ í†µí•œ ì „ì—­ exception handling](https://velog.io/@jomminii/rest-controller-advice-exception-handler)
ë‹¤ìŒê¸€ ì‘ì„±ì¤‘
ì†ŒìŠ¤ ë³´ê¸° : [github](https://github.com/jomminii/board-v1)

<br>

ì´ë²ˆì—ëŠ” custom Exception ì¸ `ServiceException` ì„ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤.

`ServiceException`ì€ ì•„ë˜ì™€ ê°™ì´ `RuntimeException`ì„ ìƒì†ë°›ì•„ êµ¬í˜„í• ê±´ë°ìš”.
> `RuntimeException`ì€ ë§ ê·¸ëŒ€ë¡œ ì»´íŒŒì¼ ì‹œì ì´ ì•„ë‹Œ ì‹¤í–‰ ì‹œì ì— ë°œìƒí•˜ëŠ” ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  `unchecked Exception`ì´ê¸° ë•Œë¬¸ì— try-catch ë¥¼ ê°•ì œí•˜ì§€ ì•Šì•„ ê°œë°œìì˜ ì˜ë„ëŒ€ë¡œ ì˜ˆì™¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  ë©¤ë²„ë³€ìˆ˜ë¡œ ê²°ê³¼ë¥¼ ì½”ë“œë¡œ êµ¬ë¶„í•œ `ResultCode` ì™€ ì—ëŸ¬ ë‚´ìš©ì„ ë‹´ì„ `message`ë¥¼ ë‹´ê³ ì í•©ë‹ˆë‹¤.


```java
public class ServiceException extends RuntimeException {

    private final ResultCode resultCode;
    private final String message;
    ...
}
```


<br>

ê·¸ëŸ¼ ë¨¼ì € `ResultCode`ë¥¼ êµ¬í˜„í•˜ê² ìŠµë‹ˆë‹¤.

```java
public interface ResultCode {

    String getResultCodeName();

    @NoArgsConstructor
    enum Common implements ResultCode {
        SUCCESS,
        FAIL,
        INVALID_REQUEST,
        ;

        @Override
        public String getResultCodeName() {
            return this.name();
        }
    }
}
```

`ResultCode`ë¥¼ interface ë¡œ ë§Œë“¤ê³  ê·¸ ì•ˆì— ì‚¬ìš©í•  êµ¬ë¶„ ë³„ë¡œ enum ì„ ë§Œë“¤ì–´ `ResultCode`ë¥¼ êµ¬í˜„í•´ì¤ë‹ˆë‹¤.

interface ì•ˆì— enum ë“¤ì„ ê·¸ë£¹ë³„ë¡œ êµ¬í˜„í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ `ResultCode`ë¼ëŠ”ê±¸ í•œ êµ°ë° ëª¨ì•„ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ë„ ìˆê³ , ë™ì¼í•œ ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ì•¼í•  ë•Œ ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ê²½ìš°ì—ëŠ” `getResultCodeName` ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ë„ë¡ í•´ enum name ì„ ë°”ë¡œ ë°˜í™˜í•  ìˆ˜ ìˆê²Œ í–ˆìŠµë‹ˆë‹¤.


<br>

ê·¸ë¦¬ê³  ì—ëŸ¬ë©”ì‹œì§€ë„ ê·¸ë•Œê·¸ë•Œ ì‘ì„±í•˜ì§€ ë§ê³  `ResultCode` ì²˜ëŸ¼ interface ì™€ enum ìœ¼ë¡œ ê´€ë¦¬í•˜ë„ë¡ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤.

```java
public interface ErrorMessages {

    String getMessage(Object... args);

    default String buildFormattedMessage(String message, String... args) {
        return MessageFormat.format(message, args);
    }

    @RequiredArgsConstructor
    enum Common implements ErrorMessages {
        INTERNAL_SERVER_ERROR("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),
        INVALID_REQUEST("ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤. ìš”ì²­ê°’ : ({0})")
        ;
        private final String message;

        @Override
        public String getMessage(String... args) {
            return buildFormattedMessage(this.message, args);
        }
    }
}
```

enum ì—ëŠ” ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë‹´ì„ ìˆ˜ ìˆë„ë¡ `message` ë¥¼ final ë¡œ ì„¤ì •í•´ì„œ ë°›ì•„ì£¼ê³  interface ì—ì„œëŠ” `getMessage`ë¥¼ êµ¬í˜„í•˜ë„ë¡ ê°•ì œí•©ë‹ˆë‹¤.  í¬ë§·íŒ…ì„ í•´ì£¼ëŠ” ë¡œì§ì€ default ë¡œ ì„ ì–¸í•´ ê³µìš©ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

`getMessage` ìì²´ë„ default ë¡œ ë¹¼ê³  ì‹¶ì—ˆì§€ë§Œ this ë¡œ enum ì„ ë°›ì•„ì•¼í•´ì„œ ë¹¼ì§ˆ ëª»í•˜ê² ë”ë¼ê³ ìš”.

<br>

ì´ì œ ëŒ€ë§ì˜ `ServiceException` ì„ êµ¬í˜„í•˜ê² ìŠµë‹ˆë‹¤.

```java
@Getter
public class ServiceException extends RuntimeException {

    private final ResultCode resultCode;
    private final String message;

    public static void throwServiceException(final ResultCode resultCode, final ErrorMessages errorMessages, final String... args) {
        throw new ServiceException(resultCode, errorMessages, args);
    }
    
    public static void throwServiceException(final ErrorMessages errorMessages, final String... args) {
        throw new ServiceException(Common.FAIL, errorMessages, args);
    }

    private ServiceException(final ResultCode resultCode, final ErrorMessages errorMessages, final String... args) {
        this.resultCode = resultCode;
        this.message = errorMessages.getMessage(args);
    }
}
```

ë¯¸ë¦¬ ë§Œë“¤ì–´ ë†“ì€ `ResultCode`ì™€ `message` ë¥¼ final ë¡œ ê°€ì§€ë„ë¡ ë§Œë“­ë‹ˆë‹¤. ê·¸ë¦¬ê³  `ServiceException` ì˜ ìƒì„±ìë¥¼ ë§Œë“¤ê³  `String args...` ë¥¼ ë°›ì„ ìˆ˜ ìˆê²Œ í•´ ì¶”ê°€ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

ìƒì„±ìëŠ” `private`ìœ¼ë¡œ ë§Œë“¤ì–´ë†¨ëŠ”ë°, static ìœ¼ë¡œ íŒ©í† ë¦¬ ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ ì›í•˜ëŠ” í˜•íƒœë¡œ `ServiceException`ì„ ë§Œë“¤ ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

íŒ©í† ë¦¬ ë©”ì„œë“œë¡œ êµ¬í˜„í•˜ë©´ ì˜¤ë²„ë¡œë”© ì‹ìœ¼ë¡œ ì›í•˜ëŠ” ì¸ìë§Œ ë°›ì•„ì„œ ì²˜ë¦¬í•˜ëŠ” ë“± ìœ ì—°ì„±ì´ ë” ë†’ì•„ì§‘ë‹ˆë‹¤.

>ì°¸ê³ ë¡œ return í˜•ì‹ì´ void ì¸ ê³³ì—ì„œëŠ” throwServiceException ì„ ì‚¬ìš©í•´ë„ ì»´íŒŒì¼ ì—ëŸ¬ê°€ ë‚˜ì§€ ì•Šì§€ë§Œ, return í˜•ì‹ì´ String ë“±ìœ¼ë¡œ ì§€ì •ëœ ë©”ì„œë“œì—ì„œ catch ë¸”ë¡ ì•ˆì— throwServiceException ë§Œ ì„ ì–¸í•´ë†“ëŠ”ë‹¤ë©´ return ëœ ë°ì´í„°ê°€ ì—†ê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ ì—ëŸ¬ê°€ ë‚©ë‹ˆë‹¤. ì´ëŸ° ê²½ìš°ì—ëŠ” public ServiceException ìƒì„±ìë¥¼ ë§Œë“¤ê³  new ServiceException() ìœ¼ë¡œ catch ë¥¼ ì²˜ë¦¬í•˜ê±°ë‚˜, return null; ë“±ìœ¼ë¡œ return ì²˜ë¦¬ë¥¼ í•´ì¤˜ì•¼í•©ë‹ˆë‹¤.

ì´ì œ `ServiceException`ì„ ë§Œë“¤ ì¤€ë¹„ëŠ” ëª¨ë‘ ëë‚¬ê³ , ìŠ¤í”„ë§ì—ì„œ ì´ exception ì„ ë°›ì•„ë‚¼ ìˆ˜ ìˆë„ë¡ `ExceptionHandler`ì— ì¶”ê°€ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

ì´ì „ ê¸€ì¸ [[Spring] RestControllerAdvice ë¥¼ í†µí•œ ì „ì—­ exception handling](https://velog.io/@jomminii/rest-controller-advice-exception-handler) ì—ì„œ ì „ì—­ í•¸ë“¤ë§ë§Œ ì¶”ê°€í•´ì¤¬ëŠ”ë° ì—¬ê¸°ì— `ServiceException` ë„ í•¸ë“¤ë§ í•  ìˆ˜ ìˆë„ë¡ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.

<br>

```java
@RestControllerAdvice
public class ApiExceptionHandler {

	// ìš”ê¸° ì¶”ê°€
    @ExceptionHandler(ServiceException.class)
    public ResultDTO<Object> handleServiceException(ServiceException exception) {
        return ResultDTO.of(exception.getResultCode(), exception.getMessage());}

	// ì´ì „ì— ì¶”ê°€í•œ ì „ì²´ Exception í•¸ë“¤ëŸ¬
    @ExceptionHandler(Exception.class)
    public ResultDTO<Object> handleException(Exception exception) {
        return ResultDTO.ofFail(exception.getMessage());
    }
}
```

`ControllerAdvice`ì— ì¶”ê°€í•´ë†“ì€ `ApiExceptionHandler`ì— `ServiceException.class`ë¥¼ ì¶”ê°€ë¡œ ìºì¹˜í•˜ë„ë¡ ì„¤ì •í•˜ê³ , ìºì¹˜í•œ `ServiceException`ì—ì„œ `ResultCode`ì™€ `message`ë¥¼ ì½ì–´ `ResultDTO`ì— ë‹´ì•„ ë°˜í™˜í•´ì¤ë‹ˆë‹¤.

<br>
ì´ì œ ì‚¬ìš©í•´ë³¼ê¹Œìš”?

```java
    @GetMapping("")
    public ResultDTO<Object> exceptionTest() {
        ServiceException.throwServiceException(Common.INVALID_REQUEST, ErrorMessages.Common.INVALID_REQUEST, "15");
        return ResultDTO.ofFail("ì‹¤íŒ¨!!");
    }
```

í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì§„ì…í•˜ìë§ˆì `ServiceException`ì„ ë‚ ë ¤ì¤ë‹ˆë‹¤.
ê·¸ëŸ¬ë©´ ê²°ê³¼ê°€ ì•„ë˜ì™€ ê°™ì´ ì˜ ë‚˜ì˜µë‹ˆë‹¤.

```shell
{
  "resultCode": "INVALID_REQUEST",
  "message": "ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤. ìš”ì²­ê°’ : (15)",
  "data": null
}
```

ì´ì œ ì¡°ê¸ˆì”© í‹€ì´ ê°–ì¶°ì ¸ê°€ë„¤ìš”!
